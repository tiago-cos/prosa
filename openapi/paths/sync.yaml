get:
  tags:
    - Sync
  summary: "Sync device"
  description: |
    Returns a list of book and shelf IDs belonging to a given user that have changed since the last sync. Results are categorized into two top-level groups: `book` and `shelf`.

    **Book categories:**
    - `file`: Newly added books.  
    - `metadata`: Books with updated metadata.  
    - `cover`: Books with updated covers.  
    - `state`: Books with updated state.  
    - `deleted`: Books that have been removed.

    **Shelf categories:**
    - `metadata`: Shelves with updated metadata.  
    - `contents`: Shelves with updated contents.  
    - `deleted`: Shelves that have been removed.

    If no user is specified, the user will be extracted from the authentication process.

    **Note:** Only admin users are allowed to retrieve sync information for other users.

  operationId: sync
  parameters:
    - name: user_id
      in: query
      description: Optional user ID for sync. If not provided, it will be extracted from the authentication process.
      required: false
      schema:
        type: string
        format: uuid
        example: d98354c3-376a-4bb3-9aa6-53583f89cf5e

    - name: since
      in: query
      description: The UNIX timestamp (milliseconds) of the last sync. If empty, assumes first sync.
      required: false
      schema:
        type: integer
        format: int64
        example: 1705740000000

  responses:
    "200":
      description: The list of books whose data has changed since the last sync.
      content:
        application/json:
          schema:
            $ref: ../components/schemas/Sync.yaml
    "400":
      $ref: ../components/responses/sync/InvalidTimestamp.yaml
    "401":
      $ref: ../components/responses/Unauthorized.yaml
    "403":
      $ref: ../components/responses/Forbidden.yaml
    "404":
      $ref: ../components/responses/users/UserNotFound.yaml

  security:
    - prosaToken: []
    - apiKey: []
